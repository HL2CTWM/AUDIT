<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI æ™ºèƒ½ç¨½æ ¸åŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ marked.js ç”¨æ–¼è§£æ AI å›å‚³çš„ Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body { font-family: 'Microsoft JhengHei', sans-serif; background-color: #f8fafc; }
        
        /* Loading Animation */
        .loading-dots:after {
            content: ' .';
            animation: dots 1s steps(5, end) infinite;
        }
        @keyframes dots {
            0%, 20% { content: ' .'; }
            40% { content: ' ..'; }
            60% { content: ' ...'; }
            80%, 100% { content: ''; }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="p-4 md:p-8 text-slate-800">

    <div class="max-w-4xl mx-auto space-y-8">
        
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 text-center">
            <h1 class="text-3xl font-bold text-slate-800 mb-2">å…§éƒ¨ç¨½æ ¸ AI æ™ºèƒ½å·¥ä½œå°</h1>
            <p class="text-slate-600">å°ˆæ³¨æ–¼ç¼ºå¤±æ”¹å–„å ±å‘Šç”Ÿæˆã€é¢¨éšªè©•ä¼°èˆ‡æ ¹å› åˆ†æ</p>
        </div>

        <!-- AI Assistant Section (Centered & Full Width) -->
        <div class="bg-gradient-to-b from-indigo-50 to-white rounded-lg shadow-lg border border-indigo-100 flex flex-col">
            <div class="p-5 border-b border-indigo-100 bg-indigo-600 rounded-t-lg flex justify-between items-center">
                <div>
                    <h2 class="text-xl font-bold text-white flex items-center">
                        <span class="text-2xl mr-2">âœ¨</span> HL2C AI ç¨½æ ¸æ™ºèƒ½åŠ©æ‰‹
                    </h2>
                    <p class="text-indigo-100 text-sm mt-1">Powered by Google Gemini</p>
                </div>
            </div>

            <div class="p-6 flex-1 flex flex-col gap-6">
                
                <!-- 1. API Key Config Section -->
                <div class="bg-indigo-50 p-4 rounded-md border border-indigo-100 shadow-sm">
                    <label class="block text-sm font-bold text-indigo-700 mb-2 flex justify-between items-center">
                        <span>ğŸ”‘ Google Gemini API Key è¨­å®š</span>
                        <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-xs bg-white text-indigo-600 px-2 py-1 rounded border border-indigo-200 hover:bg-indigo-50 transition">å–å¾— Key</a>
                    </label>
                    <input type="password" id="apiKeyInput" 
                        class="w-full p-2 border border-indigo-200 rounded text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none"
                        placeholder="è«‹åœ¨æ­¤è²¼ä¸Š API Key (sk-...)"
                        onchange="updateApiKey(this.value)">
                    <p class="text-xs text-indigo-500 mt-2 flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        æ‚¨çš„é‡‘é‘°åƒ…æš«å­˜æ–¼è¨˜æ†¶é«”ï¼Œé—œé–‰ç¶²é å³æ¸…é™¤ï¼Œè«‹å®‰å¿ƒä½¿ç”¨ã€‚
                    </p>
                </div>

                <!-- 2. Input Section -->
                <div>
                    <label class="block text-base font-medium text-slate-700 mb-2">
                        åŸå§‹ç¨½æ ¸ç™¼ç¾ / è§€å¯Ÿé»
                    </label>
                    <textarea id="auditInput" rows="5" 
                        class="w-full p-4 border border-slate-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-base shadow-sm"
                        placeholder="è«‹è¼¸å…¥ç¨½æ ¸ç™¼ç¾å…§å®¹...
ä¾‹å¦‚ï¼šä»Šæ—¥æŸ¥æ ¸ç™¼ç¾é›¶ç”¨é‡‘ä¿ç®¡ç®±åœ¨åˆä¼‘æœŸé–“æ²’æœ‰ä¸Šé–ï¼Œä¸”ç¶“è¾¦äººå“¡ä¸åœ¨åº§ä½ä¸Šã€‚"></textarea>
                </div>

                <!-- 3. Action Buttons Grid -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <button onclick="generateAuditFinding()" 
                        class="bg-white border-2 border-indigo-600 text-indigo-700 hover:bg-indigo-50 font-bold py-3 px-4 rounded-lg flex flex-col items-center justify-center transition-colors shadow-sm">
                        <span class="text-xl mb-1">ğŸ“</span>
                        <span>ç”Ÿæˆç¼ºå¤±å ±å‘Š</span>
                    </button>
                    <button onclick="assessRisk()" 
                        class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg flex flex-col items-center justify-center transition-colors shadow-md">
                        <span class="text-xl mb-1">ğŸ›¡ï¸</span>
                        <span>é¢¨éšªè©•ä¼°</span>
                    </button>
                    <button onclick="analyzeRootCause()" 
                        class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-4 rounded-lg flex flex-col items-center justify-center transition-colors shadow-md">
                        <span class="text-xl mb-1">ğŸ”</span>
                        <span>æ ¹å› åˆ†æ</span>
                    </button>
                    <button onclick="generateInterviewQuestions()" 
                        class="bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-4 rounded-lg flex flex-col items-center justify-center transition-colors shadow-md">
                        <span class="text-xl mb-1">â“</span>
                        <span>è¨ªè«‡æå•</span>
                    </button>
                </div>

                <!-- 4. Result Section -->
                <div class="flex-1 min-h-[400px] border rounded-lg bg-slate-50 relative overflow-hidden flex flex-col shadow-inner">
                    <div class="bg-slate-200 px-4 py-2 text-xs font-bold text-slate-600 uppercase tracking-wider flex justify-between items-center">
                        <span>AI åˆ†æçµæœ</span>
                        <button onclick="copyResult()" class="text-slate-500 hover:text-indigo-600 transition" title="è¤‡è£½å…§å®¹">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg>
                        </button>
                    </div>
                    <div id="resultContent" class="p-6 text-base text-slate-700 overflow-y-auto flex-1 prose prose-slate max-w-none">
                        <div class="h-full flex flex-col items-center justify-center text-slate-400 italic">
                            <svg class="w-12 h-12 mb-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                            <p>è«‹å…ˆè¼¸å…¥ API Key</p>
                            <p>æ¥è‘—è¼¸å…¥ç¨½æ ¸ç™¼ç¾ä¸¦é»æ“ŠåŠŸèƒ½æŒ‰éˆ•...</p>
                        </div>
                    </div>
                    <!-- Loading Overlay -->
                    <div id="loadingOverlay" class="absolute inset-0 bg-white/95 hidden flex flex-col items-center justify-center z-10 transition-opacity">
                        <div class="w-10 h-10 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mb-3"></div>
                        <span class="text-indigo-600 font-bold text-lg loading-dots">æ­£åœ¨æ€è€ƒä¸­</span>
                        <p class="text-indigo-400 text-sm mt-2">AI æ­£åœ¨åˆ†ææ‚¨çš„ç¨½æ ¸ç™¼ç¾...</p>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- JavaScript for Functionalities -->
    <script>
        // --- Gemini AI Integration Logic ---
        
        let userApiKey = ""; // Stores the key in memory only

        function updateApiKey(val) {
            userApiKey = val.trim();
        }

        function copyResult() {
            const content = document.getElementById('resultContent').innerText;
            navigator.clipboard.writeText(content).then(() => {
                alert("å·²è¤‡è£½çµæœåˆ°å‰ªè²¼ç°¿ï¼");
            }).catch(err => {
                console.error('è¤‡è£½å¤±æ•—:', err);
            });
        }

        const systemPrompt = `ä½ æ˜¯ä¸€ä½è³‡æ·±çš„å…§éƒ¨ç¨½æ ¸å°ˆå®¶ï¼Œç†Ÿæ‚‰ä¼æ¥­å…§éƒ¨æ§åˆ¶åˆ¶åº¦ã€é¢¨éšªè©•ä¼°èˆ‡å¯©è¨ˆæº–å‰‡ã€‚
        ä½ çš„ä»»å‹™æ˜¯å”åŠ©ç¨½æ ¸äººå“¡å°‡ç²—ç•¥çš„è§€å¯Ÿé»è½‰åŒ–ç‚ºå°ˆæ¥­çš„å·¥ä½œåº•ç¨¿ã€‚
        è«‹éµå¾ªä»¥ä¸‹åŸå‰‡ï¼š
        1. èªæ°£å°ˆæ¥­ã€å®¢è§€ã€ç°¡æ½”ã€‚
        2. å¼•ç”¨ç›¸é—œå…§æ§ç²¾ç¥ï¼ˆä¾‹å¦‚ï¼šè³‡ç”¢ä¿å…¨ã€è·è²¬åˆ†å·¥ï¼‰ã€‚
        3. è¼¸å‡ºæ ¼å¼å¿…é ˆæ¸…æ™°æ˜“è®€ï¼ˆä½¿ç”¨Markdownï¼‰ã€‚`;

        async function callGemini(userPrompt) {
            // Check for API Key
            if (!userApiKey) {
                alert("è«‹å…ˆåœ¨ä¸Šæ–¹è¼¸å…¥æ‚¨çš„ Google Gemini API Key æ‰èƒ½ä½¿ç”¨ AI åŠŸèƒ½ã€‚");
                document.getElementById('apiKeyInput').focus();
                return;
            }

            const resultDiv = document.getElementById('resultContent');
            const loadingOverlay = document.getElementById('loadingOverlay');
            
            loadingOverlay.classList.remove('hidden');
            loadingOverlay.classList.add('flex');
            
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${userApiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: userPrompt }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] }
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || response.statusText);
                }

                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                
                if (text) {
                    resultDiv.innerHTML = marked.parse(text);
                } else {
                    resultDiv.innerHTML = '<div class="flex flex-col items-center justify-center h-full text-red-500"><p class="font-bold mb-2">ç”Ÿæˆå¤±æ•—</p><p>è«‹ç¢ºèªè¼¸å…¥å…§å®¹æ˜¯å¦æ­£ç¢ºã€‚</p></div>';
                }

            } catch (error) {
                console.error("Gemini API Error:", error);
                resultDiv.innerHTML = `<div class="flex flex-col items-center justify-center h-full text-red-500"><p class="font-bold text-lg mb-2">ç™¼ç”ŸéŒ¯èª¤</p><p class="text-sm bg-red-50 p-3 rounded border border-red-200">${error.message}<br><br>è«‹æª¢æŸ¥æ‚¨çš„ API Key æ˜¯å¦æ­£ç¢ºã€‚</p></div>`;
            } finally {
                loadingOverlay.classList.add('hidden');
                loadingOverlay.classList.remove('flex');
            }
        }

        function generateAuditFinding() {
            const input = document.getElementById('auditInput').value.trim();
            if (!input) { alert("è«‹å…ˆè¼¸å…¥åŸå§‹ç¨½æ ¸ç™¼ç¾å…§å®¹"); return; }
            const prompt = `è«‹å°‡ä»¥ä¸‹ç¨½æ ¸è§€å¯Ÿé»æ”¹å¯«ç‚ºæ­£å¼çš„å…§éƒ¨ç¨½æ ¸å ±å‘Šæ ¼å¼ã€‚
            è¼¸å…¥å…§å®¹ï¼š${input}
            è«‹ä¾åºç”¢å‡ºï¼š
            1. **ç¼ºå¤±æ‘˜è¦** (Summary)ï¼šç°¡æ˜æ‰¼è¦åœ°æè¿°äº‹å¯¦ï¼Œé©åˆå¡«å…¥å ±è¡¨ã€‚
            2. **è©³ç´°èªªæ˜** (Description)ï¼šè©³ç´°æè¿°äººã€äº‹ã€æ™‚ã€åœ°ã€ç‰©åŠé•åä¹‹åŸå‰‡ã€‚
            3. **è™•ç†æ„è¦‹** (Audit Recommendation)ï¼šå…·é«”çš„æ”¹å–„å»ºè­°æªæ–½ã€‚`;
            callGemini(prompt);
        }

        function assessRisk() {
            const input = document.getElementById('auditInput').value.trim();
            if (!input) { alert("è«‹å…ˆè¼¸å…¥åŸå§‹ç¨½æ ¸ç™¼ç¾å…§å®¹"); return; }
            const prompt = `è«‹é‡å°ä»¥ä¸‹ç¨½æ ¸ç¼ºå¤±é€²è¡Œé¢¨éšªè©•ä¼°ã€‚
            ç¼ºå¤±å…§å®¹ï¼š${input}
            è«‹åˆ†æä¸¦ç”¢å‡ºï¼š
            1. **é¢¨éšªç­‰ç´š** (Risk Level)ï¼šè«‹åˆ¤å®šç‚º é«˜ / ä¸­ / ä½ï¼Œä¸¦èªªæ˜åˆ¤æ–·ç†ç”±ã€‚
            2. **æ½›åœ¨å½±éŸ¿** (Impact)ï¼šè‹¥ä¸æ”¹å–„å¯èƒ½å°è‡´çš„è²¡å‹™æˆ–ç‡Ÿé‹å¾Œæœã€‚
            3. **å»ºè­°æ‰£åˆ†å¹…åº¦** (Suggested Deduction)ï¼šä¾æ“šä¸€èˆ¬ç¨½æ ¸å¯¦å‹™ï¼Œå»ºè­°æ‰£åˆ†ç¯„åœã€‚
            è«‹ç”¨è¡¨æ ¼æˆ–åˆ—é»æ–¹å¼å‘ˆç¾ã€‚`;
            callGemini(prompt);
        }

        function analyzeRootCause() {
            const input = document.getElementById('auditInput').value.trim();
            if (!input) { alert("è«‹å…ˆè¼¸å…¥åŸå§‹ç¨½æ ¸ç™¼ç¾å…§å®¹"); return; }
            const prompt = `è«‹é‡å°ä»¥ä¸‹ç¨½æ ¸ç¼ºå¤±é€²è¡Œæ·±åº¦æ ¹å› åˆ†æèˆ‡é é˜²å»ºè­°ã€‚
            ç¼ºå¤±å…§å®¹ï¼š${input}
            è«‹åˆ†æä¸¦ç”¢å‡ºï¼š
            1. **å¯èƒ½æ ¹å›  (Root Cause)**ï¼šè«‹å¾ã€Œäººå“¡ (People)ã€ã€ã€Œæµç¨‹ (Process)ã€ã€ã€Œç³»çµ± (System)ã€ä¸‰å€‹é¢å‘åˆ†æå¯èƒ½åŸå› ã€‚
            2. **é•åä¹‹å…§æ§åŸå‰‡**ï¼šæŒ‡å‡ºæ­¤ç¼ºå¤±é•åäº†ä»€éº¼å…§æ§ç²¾ç¥ï¼ˆå¦‚ï¼šè·è²¬åˆ†å·¥ã€è¦†æ ¸æ©Ÿåˆ¶ï¼‰ã€‚
            3. **é é˜²æ€§æ§åˆ¶å»ºè­°**ï¼šå¦‚ä½•å¾æºé ­é˜²æ­¢å†æ¬¡ç™¼ç”Ÿï¼ˆSystemic Fixï¼‰ã€‚`;
            callGemini(prompt);
        }

        function generateInterviewQuestions() {
            const input = document.getElementById('auditInput').value.trim();
            if (!input) { alert("è«‹å…ˆè¼¸å…¥åŸå§‹ç¨½æ ¸ç™¼ç¾å…§å®¹"); return; }
            const prompt = `æˆ‘æ˜¯ç¨½æ ¸äººå“¡ï¼Œè§€å¯Ÿåˆ°äº†ä»¥ä¸‹ç¼ºå¤±ï¼š${input}ã€‚
            ç‚ºäº†é€²ä¸€æ­¥é‡æ¸…äº‹å¯¦ã€ç¢ºèªå½±éŸ¿ç¯„åœæˆ–äº†è§£æµç¨‹æ–·é»ï¼Œè«‹å¹«æˆ‘ç”Ÿæˆ 3-5 å€‹ã€Œå»¶ä¼¸è¨ªè«‡å•é¡Œã€ã€‚
            
            é€™äº›å•é¡Œæ‡‰è©²ï¼š
            1. é‡å°å—æŸ¥å–®ä½çš„ç¶“è¾¦äººå“¡æˆ–ä¸»ç®¡ã€‚
            2. èªæ°£å°ˆæ¥­ä½†å…·å‚™æ¢è©¢æ€§ã€‚
            3. ç›®çš„æ˜¯æŒ–æ˜å‡ºçœŸæ­£çš„å•é¡Œæ ¹æºã€‚`;
            callGemini(prompt);
        }
    </script>
</body>
</html>
